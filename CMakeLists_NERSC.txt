cmake_minimum_required(VERSION 2.6)
PROJECT( COMBINATORIAL_BLAS )
SET(CMAKE_INCLUDE_CURRENT_DIR ON)
SET(CMAKE_VERBOSE_MAKEFILE ON)
add_definitions(-DTHREADED)

SET(CMAKE_CXX_FLAGS "-DNDEBUG -O2 -w -DDGRAPH_GENERATOR_SEQ -DMPICH_IGNORE_CXX_SEEK -fopenmp")
SET(CMAKE_C_FLAGS "-DNDEBUG -O2 -Drestrict=__restrict__ -w -DGRAPH_GENERATOR_SEQ -DMPICH_IGNORE_CXX_SEEK -fopenmp")

ADD_LIBRARY( CommGridlib CommGrid.cpp  )
ADD_LIBRARY( MPITypelib MPIType.cpp )
ADD_LIBRARY( MPIOplib MPIOp.cpp  )
ADD_LIBRARY( MemoryPoollib MemoryPool.cpp )
ADD_LIBRARY( Hashlib hash.cpp )
ADD_LIBRARY( mmiolib mmio.c )


ADD_SUBDIRECTORY( ReleaseTests )
ADD_SUBDIRECTORY( Applications ) 
ADD_SUBDIRECTORY( usort ) 
ADD_SUBDIRECTORY( graph500-1.2/generator )
ADD_SUBDIRECTORY( Ordering ) 
ADD_SUBDIRECTORY( Applications/SpMSpV-IPDPS2017 )


ENABLE_TESTING()
INCLUDE(CTest)
ADD_TEST( Multiplication_Test srun -n 16 -c 12 ./ReleaseTests/MultTest TESTDATA/rmat_scale16_A.mtx TESTDATA/rmat_scale16_B.mtx TESTDATA/rmat_scale16_productAB.mtx TESTDATA/x_65536_halfdense.txt TESTDATA/y_65536_halfdense.txt )
ADD_TEST( Reduction_Test srun -n 16 -c 12 ./ReleaseTests/ReduceTest TESTDATA/sprand10000 TESTDATA/sprand10000_sumcols TESTDATA/sprand10000_sumrows)
ADD_TEST( Iterator_Test srun -n 16 -c 12 ./ReleaseTests/IteratorTest TESTDATA sprand10000)
ADD_TEST( Transpose_Test srun -n 16 -c 12 ./ReleaseTests/TransposeTest TESTDATA betwinput_scale16 betwinput_transposed_scale16)
ADD_TEST( Indexing_Test srun -n 16 -c 12 ./ReleaseTests/IndexingTest TESTDATA B_100x100.txt B_10x30_Indexed.txt rand10outta100.txt rand30outta100.txt)
ADD_TEST( SpAsgn_Test srun -n 16 -c 12 ./ReleaseTests/SpAsgnTest TESTDATA A_100x100.txt A_with20x30hole.txt dense_20x30matrix.txt A_wdenseblocks.txt 20outta100.txt 30outta100.txt)
ADD_TEST( GalerkinNew_Test srun -n 16 -c 12 ./ReleaseTests/GalerkinNew TESTDATA/grid3d_k5.txt TESTDATA/offdiag_grid3d_k5.txt TESTDATA/diag_grid3d_k5.txt TESTDATA/restrict_T_grid3d_k5.txt)
ADD_TEST( ParIO_Test srun -n 16 -c 12 ./ReleaseTests/ParIOTest TESTDATA/sevenvertex.mtx TESTDATA/sevenvertexgraph.txt)
ADD_TEST( FindSparse_Test srun -n 16 -c 12 ./ReleaseTests/FindSparse TESTDATA findmatrix.txt)
ADD_TEST( BetwCent_Test srun -n 16 -c 12 ./Applications/betwcent TESTDATA/SCALE16BTW-TRANSBOOL/ 10 96 )
ADD_TEST( TopDownBFS_Test srun -n 16 -c 12 ./Applications/tdbfs Force 18 FastGen)
ADD_TEST( DirOptBFS_Test srun -n 16 -c 12 ./Applications/dobfs 18 )
ADD_TEST( FBFS_Test srun -n 16 -c 12 ./Applications/fbfs Gen 17 )
ADD_TEST( FMIS_Test srun -n 16 -c 12 ./Applications/fmis 18 )
ADD_TEST( RCM_Test srun -n 16 -c 12 ./Ordering/rcm er 18 )
ADD_TEST( SpMSpVBench_test srun -n 16 -c 12 ./Applications/SpMSpV-IPDPS2017/SpMSpVBench -rmat 18 )
